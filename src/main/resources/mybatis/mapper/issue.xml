<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.thiki.rest.sample.mybatis.IssueMapperImpl">
    <resultMap id="issueMap" type="net.thiki.rest.sample.biz.issue.Issue">
        <constructor>
            <idArg column="id" name="id"/>
            <arg column="key" name="key"/>
            <arg column="reporter" name="reporter" resultMap="userMap"/>
            <arg column="summary" name="summary"/>
            <arg column="description" name="description"/>
            <arg column="assignee" name="assignee"/>
            <arg column="status" name="status"/>
        </constructor>

        <id column="id" property="id" jdbcType="BIGINT" javaType="long"/>
    </resultMap>

    <resultMap id="userMap" type="net.thiki.rest.sample.biz.issue.User">
        <constructor>
            <idArg column="reporter_id" name="id"/>
            <arg column="reporter_name" name="name"/>
            <arg column="reporter_key" name="key" />
            <arg column="reporter_email" name="email"/>
            <arg column="reporter_locale" name="locale"/>
        </constructor>
    </resultMap>


    <select id="findAllIssue" resultMap="issueMap">
        select
            i.`id` as `id`,
            i.`key` as `key`,
            i.summary as summary,
            i.description as description,
            i.assignee as assignee,
            i.status as status,

            r.`id` as reporter_id,
            r.name as reporter_name,
            r.`key` as reporter_key,
            r.email as reporter_email,
            r.locale as reporter_locale
        from `tms_issue` i
            left outer join `tms_user` r on i.reporter = r.id
        where 1=1
    </select>

</mapper>